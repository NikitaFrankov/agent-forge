---
name: forge-init
description: |
  Initialize agent-forge in the current project.
  Detects project stack and creates configuration file.
  Use when setting up agent-forge in a new project.
user_invocable: true
---

# /forge-init - Project Initialization

Initialize agent-forge configuration in the current project.

## Usage

```
/forge-init [--executor <name>] [--force] [--minimal]
```

### Options

- `--executor <name>` - Explicitly set executor (kotlin, rust, python, typescript, go, default)
- `--force` - Overwrite existing configuration
- `--minimal` - Create minimal config (only executor, no comments)

## What It Does

1. **Detects project stack** - Scans project files to determine executor
2. **Creates directory structure** - Sets up `.agent-forge/` with required subdirectories
3. **Creates config.yaml** - Configuration file with detected settings
4. **Creates executor.context** - Runtime executor information
5. **Updates .gitignore** - Adds agent-forge artifacts (optional, asks first)

## Execution Flow

```
/forge-init
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│ 1. DETECT                                               │
│    • Scan project files                                 │
│    • Determine executor (kotlin, rust, python, etc.)   │
│    • Load executor.json for defaults                    │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│ 2. CONFIRM                                              │
│                                                         │
│    "Detected: Kotlin/JVM                                │
│     Use this executor? [Y/n]"                           │
│                                                         │
│    If --executor flag: skip confirmation                │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│ 3. CREATE DIRECTORIES                                   │
│    mkdir -p .agent-forge/context                        │
│    mkdir -p .agent-forge/prd                            │
│    mkdir -p .agent-forge/plan                           │
│    mkdir -p .agent-forge/diagnosis                      │
│    mkdir -p .agent-forge/findings                       │
│    mkdir -p .agent-forge/phases                         │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│ 4. CREATE CONFIG                                        │
│    Write .agent-forge/config.yaml                       │
│    Include detected executor + defaults from JSON       │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│ 5. CREATE EXECUTOR CONTEXT                              │
│    Write .agent-forge/executor.context                  │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│ 6. GITIGNORE (ask)                                      │
│    "Add .agent-forge/*.context to .gitignore? [Y/n]"   │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
                    COMPLETE
```

## Examples

### Basic initialization (auto-detect)

```
/forge-init
```

Detects project type and creates configuration.

### Explicit executor

```
/forge-init --executor kotlin
```

Uses Kotlin executor regardless of auto-detection.

### Force overwrite

```
/forge-init --force
```

Overwrites existing `.agent-forge/config.yaml`.

### Minimal config

```
/forge-init --minimal
```

Creates minimal config without comments and optional sections.

## Generated Files

### .agent-forge/config.yaml

Full config with comments:

```yaml
# Agent Forge Configuration
# Generated by /forge-init at 2026-02-28

# Executor - overrides auto-detection
# Available: kotlin, rust, python, typescript, go, default
executor: kotlin

# Tool overrides (optional)
# Use this to customize commands for your project
tools:
  test: "./gradlew test --tests \"{test}\" --parallel"
  testAll: "./gradlew test"
  testCoverage: "./gradlew koverReport"
  lint: "./gradlew detekt"
  format: "./gradlew ktlintFormat"
  build: "./gradlew build"

# Pattern overrides (optional)
# Customize source/test directory locations
patterns:
  srcDir: "src/main/kotlin"
  testDir: "src/test/kotlin"

# Flow defaults (optional)
defaults:
  # Bug fix: write regression test before fixing
  testFirst: true

  # Planning: maximum review iterations
  maxPlanIterations: 5
  maxPrdIterations: 5
```

Minimal config (`--minimal`):

```yaml
# Agent Forge Configuration
executor: kotlin
```

### .agent-forge/executor.context

```
# Executor Context
# DO NOT EDIT MANUALLY

executor: kotlin
executor_source: detected
executor_display: Kotlin/JVM
detected_at: 2026-02-28T10:00:00Z
```

### Directory Structure

```
.agent-forge/
├── config.yaml           # Project configuration
├── executor.context      # Runtime executor info
├── context/              # Context packs for flows
├── prd/                  # PRD documents
├── plan/                 # Implementation plans
├── diagnosis/            # Bug diagnoses
├── findings/             # Analysis findings
└── phases/               # Refactoring phases
```

## .gitignore Integration

Recommended additions to `.gitignore`:

```gitignore
# Agent Forge - Runtime context (ignore)
.agent-forge/*.context
.agent-forge/context/

# Agent Forge - Artifacts (optional, keep for history)
# .agent-forge/diagnosis/
# .agent-forge/findings/
# .agent-forge/phases/

# Or ignore everything except config:
# .agent-forge/*
# !.agent-forge/config.yaml
```

## Executor Detection

Detection priority (first match wins):

| File | Executor |
|------|----------|
| `build.gradle.kts`, `settings.gradle.kts` | kotlin |
| `build.gradle` + `*.kt` files | kotlin |
| `Cargo.toml` | rust |
| `pyproject.toml`, `setup.py` | python |
| `package.json` + `tsconfig.json` | typescript |
| `package.json` | typescript |
| `go.mod` | go |
| (none of the above) | default |

## Implementation Steps

When executing this command:

### Step 1: Parse Arguments

```bash
# Parse CLI args from user input
FORGE_EXECUTOR=""  # --executor value
FORGE_FORCE=false  # --force flag
FORGE_MINIMAL=false # --minimal flag
```

### Step 2: Detect Executor

Use the existing detection logic from `hooks/resolve-executor.sh`:

1. Check `.agent-forge/config.yaml` for explicit `executor:` (unless --force)
2. Auto-detect from project files
3. If `--executor` flag provided, use that instead

### Step 3: Confirm with User

If no `--executor` flag and not `--force`:

```
Detected executor: Kotlin/JVM
Use this executor? [Y/n]
```

### Step 4: Create Directories

```bash
mkdir -p .agent-forge/context
mkdir -p .agent-forge/prd
mkdir -p .agent-forge/plan
mkdir -p .agent-forge/diagnosis
mkdir -p .agent-forge/findings
mkdir -p .agent-forge/phases
```

### Step 5: Create config.yaml

Read defaults from `executors/<name>/executor.json` and generate config.

### Step 6: Create executor.context

Write executor context file for runtime use.

### Step 7: Update .gitignore

Ask user if they want to add agent-forge entries to `.gitignore`.

## Verification

After running `/forge-init`, verify:

- [ ] `.agent-forge/config.yaml` exists and contains `executor:` line
- [ ] `.agent-forge/executor.context` exists
- [ ] All subdirectories created (context, prd, plan, diagnosis, findings, phases)
- [ ] `.gitignore` updated (if user agreed)

## Related Commands

- `/forge-feature` - Start feature development (uses initialized config)
- `/forge-fix` - Fix a bug (uses initialized config)
- `/forge-analyze` - Analyze codebase (uses initialized config)
- `/forge-refactor` - Refactor code (uses initialized config)
